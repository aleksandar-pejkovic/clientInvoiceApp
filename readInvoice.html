<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Show invoice info</title>
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <nav>
        <ul>
            <a href="index.html"><li>Home</li></a>
            <a href="news.asp"><li>News</li></a>
            <a href="contact.asp"><li>Contact</li></a>
            <a href="about.asp"><li>About</li></a>
            <li id="dropdown">
                <div class="dropdown">
                    <div class="dropbtn">&#9776;</div>
                    <div class="dropdown-content">
                        <a href="#">Link 1</a>
                        <a href="#">Link 2</a>
                        <a href="#">Link 3</a>
                    </div>
                </div>
            </li>

        </ul>
    </nav>

    <div id="tblContainer">

    </div>

    <script>
        window.onload = function () {
            var xhr = new XMLHttpRequest();

            xhr.onreadystatechange = function () {
                if (this.readyState != 4) return;

                if (this.status == 200) {
                    let obj = JSON.parse(this.responseText);
                    
                    console.table(obj)
                    
                    createTable(obj)
                }
            };

            xhr.open('GET', 'http://localhost:8080/invoices/listAll', true);
            xhr.send();

        }




            const createTable = function (obj) {
                const table = document.createElement("table");
                table.setAttribute('id', 'tbl')
                const header = document.createElement("tr");
                const keys = Object.keys(obj[0])
                console.log(keys)
                for (const key of keys) {
                    const th = document.createElement("th");
                    th.appendChild(document.createTextNode(key));
                    header.appendChild(th);
                }
                table.appendChild(header);
                const len = obj.length
                for (const row of obj) {
                    const tr = document.createElement("tr");
                    for (const key of keys) {
                        const td = document.createElement("td");
                        const content = row[key] || ''
                        td.appendChild(document.createTextNode(content));
                        tr.appendChild(td);
                        delete row[key]
                    }
                    for (const key in row) {
                        const th = document.createElement("th");
                        th.appendChild(document.createTextNode(key))
                        keys.push(key)
                        header.appendChild(th);
                        const td = document.createElement("td");
                        const content = row[key] || ''
                        td.appendChild(document.createTextNode(content));
                        tr.appendChild(td);
                    }
                    table.appendChild(tr);
                }
                document.getElementById("tblContainer").appendChild(table);
            }
 
        
    </script>
</body>

</html>