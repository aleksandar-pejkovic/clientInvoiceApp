<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Customer</title>
    <link rel="stylesheet" href="style.css">
</head>

<body>

    <nav>
        <ul>
            <a href="index.html">
                <li>Home</li>
            </a>
            <a href="news.asp">
                <li>News</li>
            </a>
            <a href="contact.asp">
                <li>Contact</li>
            </a>
            <a href="about.asp">
                <li>About</li>
            </a>
            <li id="dropdown">
                <div class="dropdown">
                    <div class="dropbtn">&#9776;</div>
                    <div class="dropdown-content">
                        <a href="#">Link 1</a>
                        <a href="#">Link 2</a>
                        <a href="#">Link 3</a>
                    </div>
                </div>
            </li>

        </ul>
    </nav>

    <div id="tblContainer">

    </div>

    <div class="selectionContainer">
        <a href="createCustomer.html" class="selectionWindow">
            <div>
                Create
            </div>
        </a>
        <a href="readCustomer.html" class="selectionWindow">
            <div>
                Read
            </div>
        </a>
        <a href="updateCustomer.html" class="selectionWindow">
            <div>
                Update
            </div>
        </a>
        <a href="deleteCustomer.html" class="selectionWindow">
            <div>
                Delete
            </div>
        </a>
    </div>

    <div class="regularDiv">
        <h1>Customers</h1>
        <h3>Instructions about making rest calls with JSON format examples</h3>
        <p>
            {<br>
            "name":"Customer name",<br>
            "address":"Street name",<br>
            "zip":"zip number",<br>
            "city":"City name",<br>
            "pib":"tax id number",<br>
            "mb":"company id",<br>
            "phone":"phone number",<br>
            "bankAccount":"bank account number",<br>
            "email":"email address"<br>
            }
        </p>
        <p>
            POST - http://localhost:8080/customers/create (JSON) <br>
            GET - http://localhost:8080/customers/listAll <br>
            GET - http://localhost:8080/customers/name/customerName <br>
            PUT - http://localhost:8080/customers/update (JSON; can't change pib) <br>
        </p>
    </div>

    <script>
        window.onload = function () {
            var xhr = new XMLHttpRequest();

            xhr.onreadystatechange = function () {
                if (this.readyState != 4) return;

                if (this.status == 200) {
                    let customers = JSON.parse(this.responseText);
                    console.table(customers)
                    createTable(customers)
                }
            };

            xhr.open('GET', 'http://localhost:8080/customers/listAll', true);
            xhr.send();

        }




        const createTable = function (obj) {
            const table = document.createElement("table");
            table.setAttribute('id', 'tbl')
            const header = document.createElement("tr");
            const keys = Object.keys(obj[0])
            console.log(keys)
            for (const key of keys) {
                const th = document.createElement("th");
                th.appendChild(document.createTextNode(key));
                header.appendChild(th);
            }
            table.appendChild(header);
            const len = obj.length
            for (const row of obj) {
                const tr = document.createElement("tr");
                for (const key of keys) {
                    const td = document.createElement("td");
                    const content = row[key] || ''
                    td.appendChild(document.createTextNode(content));
                    tr.appendChild(td);
                    delete row[key]
                }
                for (const key in row) {
                    const th = document.createElement("th");
                    th.appendChild(document.createTextNode(key))
                    keys.push(key)
                    header.appendChild(th);
                    const td = document.createElement("td");
                    const content = row[key] || ''
                    td.appendChild(document.createTextNode(content));
                    tr.appendChild(td);
                }
                table.appendChild(tr);
            }
            document.getElementById("tblContainer").appendChild(table);
        }
    </script>
</body>

</html>